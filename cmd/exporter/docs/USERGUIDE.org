#+options: ':nil *:t -:t ::t <:t H:5 \n:nil ^:t arch:headline
#+options: author:t broken-links:nil c:nil creator:nil
#+options: d:(not "LOGBOOK") date:t e:t email:nil expand-links:t f:t
#+options: inline:t num:t p:nil pri:nil prop:nil stat:t tags:t
#+options: tasks:t tex:t timestamp:t title:t toc:t todo:t |:t
#+title: USERGUIDE
#+date: <2025-12-10 Wed>
#+author:
#+language: en
#+select_tags: export
#+exclude_tags: noexport
#+creator: Emacs 30.2 (Org mode 9.7.27)
#+cite_export:

* Metadata :noexport:

#+name: data
| CLI name | xpcf |

#+name: config
#+begin_src elisp :var input="invalid" :var data=data()
(cadr (seq-find (lambda (row)
		  (string= input (car row)))
		data '(nil, "invalid")))
#+end_src

#+name: ansi-filter
#+begin_src elisp :var data="test" :exports none :eval yes
(ansi-color-filter-apply data)
#+end_src

* Shell session :noexport:

#+name: alias-tmpl
#+begin_example
${cli_name}='go run -ldflags "-X main.ShortName=${cli_name}" ../exporter/'
#+end_example

#+name: alias-command
#+begin_src sh :results output :var tmpl=alias-tmpl :var cli_name=config("CLI name")
export cli_name
echo "$tmpl" | envsubst
#+end_src

#+RESULTS: alias-command
: xpcf='go run -ldflags "-X main.ShortName=xpcf" ../../exporter/'
:

#+name: set-alias
#+begin_src bash :session exporter :noweb yes
alias <<config("CLI name")>>='go run -ldflags "-X main.ShortName=<<config("CLI name")>>" ../'
#+end_src

#+RESULTS:

* VHS :noexport:

#+name: vhs-code-template
#+begin_example
Set Shell "bash"
Set FontSize 16
Set Width 1200
Set Height 400

Hide

Type `alias ${cli_name}='go run -ldflags "-X main.ShortName=${cli_name}" ../../exporter/'` Enter
Env XDG_CONFIG_HOME "/tmp"
Type "clear" Enter

Show

${vhs_command}

Sleep 5s
#+end_example

#+name: vhs_command
#+begin_src sh :result output :var vhs_command="Type `# test command` Sleep 5s" :var cli_name=config("CLI name")
export cli_name
echo "$vhs_command" | envsubst
#+end_src

#+name: vhs-code
#+begin_src sh :results output :var tmpl=vhs-code-template :var cli_name=config("CLI name") :var cmd_tmpl="${cli_name} --helppp"
export cli_name
export vhs_command=$(echo "$cmd_tmpl" | envsubst)
echo "$tmpl" | envsubst
#+end_src

** Help flag

#+name: help-flag
#+begin_example
Output vhs/qs-login.gif
Type "${cli_name} --help"  Sleep 1500ms  Enter
#+end_example

#+begin_src sh :results output :var tapefile=vhs-code(cmd_tmpl=help-flag)
echo $tapefile | vhs -
#+end_src

#+RESULTS:
#+begin_example
Set Shell bash
Set FontSize 16
Set Width 1200
Set Height 600
Hide
Type alias xpcf='go run -ldflags "-X main.ShortName=xpcf" ../../exporter/'
Enter 1
Type clear
Enter 1
Show
Output .gif vhs/qs-login.gif
Type xpcf --help
Sleep 1500ms
Enter 1
Sleep 5s
#+end_example

** Login

#+name: login
#+begin_example
Output vhs/login.gif
Type "${cli_name} login"  Sleep 1500ms  Enter
Sleep 2s
Type "https://api.cf.system.com" Sleep 1500ms Enter
Sleep 2s
Type "technical-user-name" Sleep 1500ms Enter
Sleep 2s
Type "test-password-for-technical-user" Sleep 1500ms Enter
#+end_example

#+begin_src sh :results output :var tapefile=vhs-code(cmd_tmpl=login)
echo $tapefile | vhs -
#+end_src

* Introduction

The call_config("CLI name") {{{results(=cf-export=)}}} tool observes
/Cloud Foundry/ resources and exports them as managed Crossplane
resources as defined by the Cloud Foundry Crossplane provider[fn:1].

* TODO Installation
:PROPERTIES:
:CUSTOM_ID: installation
:END:

* Quick Start

First, obtain /Cloud Foundry/ technical user credentials (username
and password) and a /Cloud Foundry/ API endpoint.

Then, install call_config("CLI name") by following the instructions in
[[#installation][Installation]].

Let's verify that the binary can be executed using the =--help= flag.

#+begin_src bash :results output :session exporter :noweb yes :exports both :var a=set-alias()
<<config("CLI name")>> --help
#+end_src

#+RESULTS:
#+begin_example
Cloud Foundry exporting tool is a CLI tool for exporting existing resources as Crossplane managed resources

Usage:
  xpcf [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  export      Export Cloud Foundry resources
  help        Help about any command
  login       Logging in to Cloud Foundry cluster

Flags:
  -c, --config string   Configuration file
  -h, --help            help for xpcf
  -v, --verbose         Verbose output

Use "xpcf [command] --help" for more information about a command.
#+end_example

Next, you can persist your /Cloud Foundry/ credentials using the
=login= subcommand.

#+caption: Login subcommand
[[file:vhs/login.gif]]

Now you can export all /Organizations/ using the following command:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*)
<<config("CLI name")>> export --kind organization --org '.*'
#+end_src

Let's export all spaces:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*)
<<config("CLI name")>> export --kind space --org '.*' --space '.*'
#+end_src

* Configuration

The behaviour of the call_config("CLI name") tool can be modified by
setting various configuration parameters. Some parameters are global
and apply to all subcommands, while others are specific to certain
subcommands.

Configuration parameters can be set through multiple methods:

- command line flags
- environment variables
- configuration file

The precedence of these methods is as follows: values set in a
configuration file are overridden by environment variables, and
command line flags have the highest precedence.

** Command Line Flags

A command line flag may have two forms: a long form (mandatory) and a
short form (optional). Flags may require a value. For /bool/ type
configuration parameters, the presence of the flag indicates a true
value.

The following examples demonstrate different usages of CLI flags.

*** Setting a bool to /true/ using a short flag

The global =verbose= configuration parameter can be set using the
short flag =-v=.

Example:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export -v
#+end_src

*** Setting a bool to /true/ using a long flag

The =verbose= parameter can also be set using the long flag =--verbose=:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --verbose
#+end_src

*** Setting a bool to /false/

A /bool/ configuration parameter can be explicitly set to false using
the following format:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --verbose=false
#+end_src

Or using the short flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export -v=false
#+end_src

*** Setting a string value

The =kind= configuration parameter of the =export= subcommand accepts
string values. You can set it as follows:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --kind space
#+end_src

Alternatively, you can use the equal sign:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --kind=space
#+end_src

*** Setting multiple strings

Some configuration parameters accept a list of strings. The =kind=
parameter is one such example. You can specify multiple values by
repeating the flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --kind=space --kind=organization
#+end_src

** Environment Variables

Certain configuration parameters can be set using environment
variables.

For a parameter of type /bool/, set the value of the environment
variable to ="1"=:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
VERBOSE=1 <<config("CLI name")>> export
#+end_src

If the configuration parameter is of type /list of strings/, separate
the list elements with /space/ characters:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
KIND="organization space" <<config("CLI name")>> export
#+end_src

** Configuration File
:PROPERTIES:
:CUSTOM_ID: config-file
:END:

Configuration parameter values can also be set using a configuration
file. The configuration file uses YAML format and must contain a YAML
object where each key corresponds to a configuration parameter.

An example configuration file =example-config.yaml= is shown below:

#+begin_src yaml :tangle example-config.yaml
verbose: true
kind:
  - organization
  - space
#+end_src

To use a configuration file, specify it with the =-c= or =--config=
command line flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --config example-config.yaml
#+end_src

If no configuration file is specified, the tool searches for one in
the directories specified by =XDG_CONFIG_HOME= and =HOME=, in that
order.

* Commands Reference

The call_config("CLI name") tool supports four subcommands:

- =completion=
- =export=
- =help=
- =login=

The =completion= subcommand generates autocompletion scripts for
various shells:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> completion --help
#+end_src

The =help= subcommand prints a generic help message about subcommands
and global CLI flags.

The =export= and =login= subcommands are detailed in the following
sections.

** Global Configuration Parameters
:PROPERTIES:
:CUSTOM_ID: global-params
:END:

The global configuration parameters apply to all subcommands.

*** Help

| Type                 | bool            |
|----------------------+-----------------|
| CLI flag             | =-h= / =--help= |
| Environment variable | -               |
| Config file key      | -               |

Each subcommand provides a help option. Help can be invoked with the
=-h= or =--help= CLI flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval no-export
<<config("CLI name")>> login --help
#+end_src

*** Config

| Type                 | string            |
|----------------------+-------------------|
| CLI flag             | =-c= / =--config= |
| Environment variable | -                 |
| Config file key      | -                 |

The =config= parameter specifies the path to the configuration file.
The =export= subcommand reads configuration parameter values from the
specified file.

The =login= subcommand writes the credentials to the specified
configuration file. For more details about using the configuration
file, refer to the [[#config-file][Configuration File]] section.

*** Verbose

| Type                 | bool               |
|----------------------+--------------------|
| CLI flag             | =-v= / =--verbose= |
| Environment variable | -                  |
| Config file key      | =verbose=          |

When set, the =verbose= configuration parameter enables printing of
/debug-level/ messages. This can be helpful for troubleshooting.

** Subcommands
*** Login
:PROPERTIES:
:CUSTOM_ID: login
:END:

The =login= subcommand persists the [[#apiurl][API URL]], [[#username][username]], and [[#password][password]]
configuration parameter values in the config file.

#+caption: Login subcommand
[[file:vhs/login.gif]]

*** Export

The =export= subcommand exports the specified resources from a /Cloud
Foundry/ cluster. The operation performs the following steps:

1. Inspects the configured parameters. If the configuration parameters
   are insufficient to perform the requested operation, the user is
   prompted interactively to provide the missing values.
2. Collects the resource configuration via the API.
3. Converts the resource configuration according to the Crossplane
   provider managed resource schemas.
4. Prints the Crossplane managed resource definitions in YAML format
   to the screen or to a file.

**** Authentication

There are various ways to configure the authentication parameters in
call_config("CLI name").

The simplest approach is to use the =cf= CLI tool's[fn:2] =login=
subcommand[fn:3]. This creates a configuration file with the /Cloud
Foundry/ API credentials, which can be reused by call_config("CLI name")
through the [[#use-cf-login][=use-cf-login=]] configuration parameter. See
[[#use-cf-login][use-cf-login]] for details.

The [[#apiurl][API URL]], [[#username][username]], and [[#password][password]] for the /Cloud Foundry/ environment
can also be specified using configuration parameters via CLI flags,
environment variables, or the configuration file.

The =login= subcommand can be used to update the configuration file
with the [[#apiurl][API URL]], [[#username][username]], and [[#password][password]] values.

***** API URL
:PROPERTIES:
:CUSTOM_ID: apiurl
:END:

| Type                 | string            |
|----------------------+-------------------|
| CLI flag             | =-a= / =--apiUrl= |
| Environment variable | =API_URL=         |
| Config file key      | =apiurl=          |

This configuration parameter specifies the URL of the /Cloud Foundry/
API.

***** Username
:PROPERTIES:
:CUSTOM_ID: username
:END:

| Type                 | string              |
|----------------------+---------------------|
| CLI flag             | =-u= / =--username= |
| Environment variable | =USERNAME=          |
| Config file key      | =username=          |

This configuration parameter specifies the username for authenticating
with the /Cloud Foundry/ API.

***** Password
:PROPERTIES:
:CUSTOM_ID: password
:END:

| Type                 | string              |
|----------------------+---------------------|
| CLI flag             | =-p= / =--password= |
| Environment variable | =PASSWORD=          |
| Config file key      | =password=          |

This configuration parameter specifies the password for authenticating
with the /Cloud Foundry/ API.


**** Configuration Parameters

The =export= subcommand can be configured using the [[#apiurl][API URL]], [[#username][username]],
and [[#password][password]] configuration parameters. These parameters allow you to
define the authentication details for the Cloud Foundry cluster from
which resources are exported.

Alternatively, it is more convenient to use the [[#login][login]] subcommand,
which persists these parameters in the configuration file so you don't
have to specify their values for each command.

In addition to the [[#global-params][global configuration parameters]], the =export=
subcommand also supports several subcommand-specific configuration
parameters.

***** Use CF Login
:PROPERTIES:
:CUSTOM_ID: use-cf-login
:END:

| Type                 | bool             |
|----------------------+------------------|
| CLI flag             | =--use-cf-login= |
| Environment variable | =USE_CF_LOGIN=   |
| Config file key      | =use-cf-login=   |


When set, the configuration file generated by =cf login= is used for
authentication.

***** Kind
:PROPERTIES:
:CUSTOM_ID: kind
:END:

| Type                 | []string        |
|----------------------+-----------------|
| CLI flag             | =--kind= / =-k= |
| Environment variable | =KIND=          |
| Config file key      | =kind=          |

Specifies the resource kinds to export. If not set, the user is
prompted interactively.

The possible values are:

- =organization=
- =orgrole=
- =serviceinstance=
- =space=
- =spacerole=

***** Output
:PROPERTIES:
:CUSTOM_ID: output
:END:

| Type                 | string            |
|----------------------+-------------------|
| CLI flag             | =--output= / =-o= |
| Environment variable | =OUTPUT=          |
| Config file key      | =output=          |

The =output= parameter specifies a filename to redirect the exported
YAML output to.

***** Resolve References
:PROPERTIES:
:CUSTOM_ID: resolve-references
:END:

| Type                 | bool                          |
|----------------------+-------------------------------|
| CLI flag             | =--resolve-references= / =-r= |
| Environment variable | =RESOLVE_REFERENCES=          |
| Config file key      | =resolve-references=          |

When the =resolve-references= parameter is set, cross-resource
references are resolved. For example, instead of an =org= field with a
GUID value, the =org.name= field is set when a resource refers to an
=Organization= resource.

***** Org
:PROPERTIES:
:CUSTOM_ID: org
:END:

| Type                 | []string       |
|----------------------+----------------|
| CLI flag             | =--org=        |
| Environment variable | -              |
| Config file key      | =organization= |

When exporting /Organization/ resource kinds, the =org= parameter
value specifies regular expressions that the /Organization/ names must
match.

***** Space
:PROPERTIES:
:CUSTOM_ID: space
:END:

| Type                 | []string  |
|----------------------+-----------|
| CLI flag             | =--space= |
| Environment variable | -         |
| Config file key      | =space=   |

When exporting /Space/ resource kinds, the =space= parameter value
specifies regular expressions that the /Space/ names must match.

***** ServiceInstance
:PROPERTIES:
:CUSTOM_ID: serviceinstance
:END:

| Type                 | []string            |
|----------------------+---------------------|
| CLI flag             | =--serviceinstance= |
| Environment variable | -                   |
| Config file key      | =serviceinstance=   |

When exporting /ServiceInstance/ resource kinds, the =serviceinstance=
parameter value specifies regular expressions that the
/ServiceInstance/ names must match.



* Common Workflows

** Logging in using username and password

* Troubleshooting

* FAQ

* Footnotes

[fn:1] https://github.com/SAP/crossplane-provider-cloudfoundry/tree/feat/export-tool

[fn:2] https://docs.cloudfoundry.org/cf-cli/

[fn:3] https://docs.cloudfoundry.org/cf-cli/getting-started.html#login

# Local Variables:
# org-confirm-babel-evaluate: nil
# End:
