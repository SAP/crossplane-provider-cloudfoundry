#+options: ':nil *:t -:t ::t <:t H:3 \n:nil ^:t arch:headline
#+options: author:t broken-links:nil c:nil creator:nil
#+options: d:(not "LOGBOOK") date:t e:t email:nil expand-links:t f:t
#+options: inline:t num:t p:nil pri:nil prop:nil stat:t tags:t
#+options: tasks:t tex:t timestamp:t title:t toc:t todo:t |:t
#+title: USERGUIDE
#+date: <2025-12-10 Wed>
#+author:
#+language: en
#+select_tags: export
#+exclude_tags: noexport
#+creator: Emacs 30.2 (Org mode 9.7.27)
#+cite_export:

* Metadata :noexport:

#+name: data
| CLI name | xpcf |

#+name: config
#+begin_src elisp :var input="invalid" :var data=data()
(cadr (seq-find (lambda (row)
		  (string= input (car row)))
		data '(nil, "invalid")))
#+end_src

#+name: ansi-filter
#+begin_src elisp :var data="test" :exports none :eval yes
(ansi-color-filter-apply data)
#+end_src

* Shell session :noexport:

#+name: alias-tmpl
#+begin_example
${cli_name}='go run -ldflags "-X main.ShortName=${cli_name}" ../exporter/'
#+end_example

#+name: alias-command
#+begin_src sh :results output :var tmpl=alias-tmpl :var cli_name=config("CLI name")
export cli_name
echo "$tmpl" | envsubst
#+end_src

#+RESULTS: alias-command
: xpcf='go run -ldflags "-X main.ShortName=xpcf" ../../exporter/'
:

#+name: set-alias
#+begin_src bash :session exporter :noweb yes
alias <<config("CLI name")>>='go run -ldflags "-X main.ShortName=<<config("CLI name")>>" ../'
#+end_src

#+RESULTS:

* VHS :noexport:

#+name: vhs-code-template
#+begin_example
Set Shell "bash"
Set FontSize 16
Set Width 1200
Set Height 400

Hide

Type `alias ${cli_name}='go run -ldflags "-X main.ShortName=${cli_name}" ../../exporter/'` Enter
Env XDG_CONFIG_HOME "/tmp"
Type "clear" Enter

Show

${vhs_command}

Sleep 5s
#+end_example

#+name: vhs_command
#+begin_src sh :result output :var vhs_command="Type `# test command` Sleep 5s" :var cli_name=config("CLI name")
export cli_name
echo "$vhs_command" | envsubst
#+end_src

#+name: vhs-code
#+begin_src sh :results output :var tmpl=vhs-code-template :var cli_name=config("CLI name") :var cmd_tmpl="${cli_name} --helppp"
export cli_name
export vhs_command=$(echo "$cmd_tmpl" | envsubst)
echo "$tmpl" | envsubst
#+end_src

** Help flag

#+name: help-flag
#+begin_example
Output vhs/qs-login.gif
Type "${cli_name} --help"  Sleep 1500ms  Enter
#+end_example

#+begin_src sh :results output :var tapefile=vhs-code(cmd_tmpl=help-flag)
echo $tapefile | vhs -
#+end_src

#+RESULTS:
#+begin_example
Set Shell bash
Set FontSize 16
Set Width 1200
Set Height 600
Hide
Type alias xpcf='go run -ldflags "-X main.ShortName=xpcf" ../../exporter/'
Enter 1
Type clear
Enter 1
Show
Output .gif vhs/qs-login.gif
Type xpcf --help
Sleep 1500ms
Enter 1
Sleep 5s
#+end_example

** Login

#+name: login
#+begin_example
Output vhs/login.gif
Type "${cli_name} login"  Sleep 1500ms  Enter
Sleep 2s
Type "https://api.cf.system.com" Sleep 1500ms Enter
Sleep 2s
Type "technical-user-name" Sleep 1500ms Enter
Sleep 2s
Type "test-password-for-technical-user" Sleep 1500ms Enter
#+end_example

#+begin_src sh :results output :var tapefile=vhs-code(cmd_tmpl=login)
echo $tapefile | vhs -
#+end_src

* Introduction

The call_config("CLI name") {{{results(=cf-export=)}}} tool observes
/Cloud Foundry/ resources and exports them as managed Crossplane
resources as defined by the Cloud Foundry Crossplane provider[fn:1].

* TODO Installation
:PROPERTIES:
:CUSTOM_ID: installation
:END:

* Quick Start

First, obtain /Cloud Foundry/ technical user credentials (username
and password) and a /Cloud Foundry/ API endpoint.

Then, install call_config("CLI name") by following the instructions in
[[#installation][Installation]].

Let's verify that the binary can be executed using the =--help= flag.

#+begin_src bash :results output :session exporter :noweb yes :exports both :var a=set-alias()
<<config("CLI name")>> --help
#+end_src

#+RESULTS:
#+begin_example
Cloud Foundry exporting tool is a CLI tool for exporting existing resources as Crossplane managed resources

Usage:
  xpcf [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  export      Export Cloud Foundry resources
  help        Help about any command
  login       Logging in to Cloud Foundry cluster

Flags:
  -c, --config string   Configuration file
  -h, --help            help for xpcf
  -v, --verbose         Verbose output

Use "xpcf [command] --help" for more information about a command.
#+end_example

Next, you can persist your /Cloud Foundry/ credentials using the
=login= subcommand.

#+caption: Login subcommand
[[file:vhs/login.gif]]

Now you can export all /Organizations/ using the following command:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*)
<<config("CLI name")>> export --kind organization --org '.*'
#+end_src

Let's export all spaces:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*)
<<config("CLI name")>> export --kind space --org '.*' --space '.*'
#+end_src

* Configuration

The behaviour of the call_config("CLI name") tool can be modified by
setting various configuration parameters. Some parameters are global
and apply to all subcommands, while others are specific to certain
subcommands.

Configuration parameters can be set through multiple means:

- command line flags
- environment variables
- configuration file

The precedence of these methods is as follows: values set in a
configuration file are overridden by environment variables, and
command line flags have the highest precedence.

** Command Line Flags

A command line flag may have two forms: a long form (mandatory) and
a short form (optional). Flags may require a value. For /bool/ type
configuration parameters, the presence of the flag indicates a true
value.

The following examples demonstrate different usages of CLI flags.

*** Setting a bool to /true/ using a short flag

The global =verbose= configuration parameter can be set using the
short flag =-v=.

Example:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export -v
#+end_src

*** Setting a bool to /true/ using a long flag

The =verbose= parameter can also be set using the long flag =--verbose=:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --verbose
#+end_src

*** Setting a bool to /false/

A /bool/ configuration parameter can be explicitly set to false using
the following format:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --verbose=false
#+end_src

Or using the short flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export -v=false
#+end_src

*** Setting a string value

The =kind= configuration parameter of the =export= subcommand accepts
string values. You can set it as follows:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --kind space
#+end_src

Alternatively, you can use the equal sign:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --kind=space
#+end_src

*** Setting multiple strings

Some configuration parameters accept a list of strings. The =kind=
parameter is one such example. You can specify multiple values by
repeating the flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --kind=space --kind=organization
#+end_src

** Environment Variables

Certain configuration parameters can be set using environment
variables.

For a parameter of type /bool/, set the value of the environment
variable to ="1"=:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
VERBOSE=1 <<config("CLI name")>> export
#+end_src

If the configuration parameter is of type /list of strings/, separate
the list elements with /space/ characters:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
KIND="organization space" <<config("CLI name")>> export
#+end_src

** Configuration File

Configuration parameter values can also be set using a configuration
file. The configuration file uses YAML format and must contain a YAML
object where each key is a configuration parameter.

An example configuration file =example-config.yaml= is shown below:

#+begin_src yaml :tangle example-config.yaml
verbose: true
kind:
  - organization
  - space
#+end_src

To use a configuration file, specify it with the =-c= or =--config=
command line flag:

#+begin_src bash :results output :session exporter :noweb yes :var a=set-alias() :post ansi-filter(data=*this*) :eval never
<<config("CLI name")>> export --config example-config.yaml
#+end_src

If no configuration file is specified, the tool searches for one ine
the directories specified by =XDG_CONFIG_HOME= and =HOME=, in that
order.

* Commands Reference

* Common Workflows

* Troubleshooting

* FAQ

* Footnotes

[fn:1] https://github.com/SAP/crossplane-provider-cloudfoundry/tree/feat/export-tool

# Local Variables:
# org-confirm-babel-evaluate: nil
# End:
